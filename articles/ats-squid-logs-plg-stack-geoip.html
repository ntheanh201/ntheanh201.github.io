<!doctype html>
<html>
  <head>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico" />
    <script async src="https://cdn.splitbee.io/sb.js"></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="referrer" content="always" />
    <link
      rel="alternate"
      type="application/atom+xml"
      title="RSS 2.0"
      href="/atom.xml"
    />
    <link rel="canonical" href="https://ntheanh201.id.vn/articles/ats-squid-logs-plg-stack-geoip.html" />
    

    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@ntheanh201" />
    <meta name="twitter:title" content="Gi√°m s√°t ATS Squid Logs v·ªõi PLG Stack v√† GeoIP: Ph√¢n t√≠ch v·ªã tr√≠ ng∆∞·ªùi d√πng theo th·ªùi gian th·ª±c" />
    
    <meta name="twitter:creator" content="@ntheanh201" />
    
    <meta name="twitter:image" content="https://ntheanh201.id.vn" />
     

    
    <meta property="og:title" content="Gi√°m s√°t ATS Squid Logs v·ªõi PLG Stack v√† GeoIP: Ph√¢n t√≠ch v·ªã tr√≠ ng∆∞·ªùi d√πng theo th·ªùi gian th·ª±c" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://ntheanh201.id.vn/articles/ats-squid-logs-plg-stack-geoip.html" />
     
    <meta property="og:image" content="https://ntheanh201.id.vn" />
    

    <title>Gi√°m s√°t ATS Squid Logs v·ªõi PLG Stack v√† GeoIP: Ph√¢n t√≠ch v·ªã tr√≠ ng∆∞·ªùi d√πng theo th·ªùi gian th·ª±c</title>

    <link href="/css/main.css" rel="stylesheet" />
    <link href="/css/style.css" rel="stylesheet" />
    <script type="text/javascript">
      function showcontact() {
        var el = document.getElementById("contact-form");
        el.style.display = "block";
        el = document.getElementById("contact-page-url");
        var uri = window.location.href;
        uri = uri.replace("#", "");
        el.value = uri;
        el = document.getElementById("msg-for-chris");
        el.focus();
      }

      function hidecontact() {
        var el = document.getElementById("contact-form");
        el.style.display = "none";
      }

      function isWindows() {
        return (
          window.navigator &&
          window.navigator.platform &&
          window.navigator.platform.indexOf("Win") >= 0
        );
      }

      function maybeShowAd() {
        
        

      }

      function onLoaded() {
        maybeShowAd();
      }

      document.addEventListener("DOMContentLoaded", onLoaded);
    </script>
    <script type="text/javascript">
      var galleries = {}; 
      function buildGalleriesInfo() {
        var els = document.getElementsByTagName("img");
        var n = els.length;
        for (var i = 0; i < n; i++) {
          var el = els[i];
          var id = el.id;
          if (!id.startsWith("id-thumb-img-")) {
            continue;
          }
          id = id.replace("id-thumb-img-", "");
          
          var parts = id.split("-");
          var galleryID = parseInt(parts[0]);
          var imageNo = parseInt(parts[1]);
          var galleryInfo = galleries[galleryID] || {};
          galleryInfo[imageNo] = el.src;
          galleries[galleryID] = galleryInfo;
        }
        var ids = Object.keys(galleries);
        for (var gid of ids) {
          var galleryInfo = galleries[gid];
          galleryInfo.nImages = Object.keys(galleryInfo).length;
          galleryInfo.currImageNo = 0;
          changeShot(gid, 0);
        }
      }

      function changeShot(galleryID, imgNo) {
        var gi = galleries[galleryID];
        gi.currImageNo = imgNo;
        var url = gi[imgNo];
        var id = "id-gallery-" + galleryID;
        var el = document.getElementById(id);
        el.src = url;
        
        for (var i = 0; i < gi.nImages; i++) {
          id = "id-thumb-" + galleryID + "-" + i;
          el = document.getElementById(id);
          if (i == imgNo) {
            el.classList.add("selected-img");
          } else {
            el.classList.remove("selected-img");
          }
        }
        var els = document.getElementsByTagName("div");
        var nEls = els.length;
      }

      function imgNext(galleryID) {
        var gi = galleries[galleryID];
        var nImages = gi.nImages;
        var imgNo = gi.currImageNo;
        imgNo = (imgNo + 1) % nImages;
        changeShot(galleryID, imgNo);
      }

      function imgPrev(galleryID) {
        var gi = galleries[galleryID];
        var imgNo = gi.currImageNo - 1;
        if (imgNo < 0) {
          imgNo = gi.nImages - 1;
        }
        changeShot(galleryID, imgNo);
      }

      document.addEventListener("DOMContentLoaded", buildGalleriesInfo);
    </script>
  </head>

  <body>
    <nav class="site-header">
    <div class="site-header-inner">
        <a href="/" class="site-header-brand">ntheanh201</a>
        <div class="site-header-nav">
            <a href="/archives.html" class="nav-link">ARTICLES</a>
            <a href="https://github.com/ntheanh201" class="nav-link" target="_blank">GITHUB</a>
            <a href="https://linkedin.com/in/ntheanh201" class="nav-link" target="_blank">LINKEDIN</a>
        </div>
    </div>
</nav>

    <div id="content" class="article-page">
      <div class="article-hero">
        <h1 class="article-title">Gi√°m s√°t ATS Squid Logs v·ªõi PLG Stack v√† GeoIP: Ph√¢n t√≠ch v·ªã tr√≠ ng∆∞·ªùi d√πng theo th·ªùi gian th·ª±c</h1>
      </div>

      

      <div class="article-layout">
        
        
        <div class="article-sidebar-left">
          <div class="article-sidebar-sticky">
            <div class="article-sidebar-block">
              <div class="article-sidebar-type">Article</div>
              <div class="article-sidebar-title">Gi√°m s√°t ATS Squid Logs v·ªõi PLG Stack v√† GeoIP: Ph√¢n t√≠ch v·ªã tr√≠ ng∆∞·ªùi d√πng theo th·ªùi gian th·ª±c</div>
              <a href="/articles/ats-squid-logs-plg-stack-geoip.html" class="article-sidebar-permalink">üîó</a>
            </div>

            <div class="article-sidebar-block">
              <table class="article-sidebar-table">
                <tr>
                  <td>
                    <div class="article-sidebar-cell-label">Published</div>
                    <div class="article-sidebar-cell-value">
                      Mar 15, 2024
                    </div>
                  </td>
                  
                  <td>
                    <div class="article-sidebar-cell-label">Tags</div>
                    <div class="article-sidebar-cell-value">
                      <a
                        href="/tag/apache.html"
                        class="article-sidebar-tag-link"
                        >apache</a
                      >, <a
                        href="/tag/cdn.html"
                        class="article-sidebar-tag-link"
                        >cdn</a
                      >, <a
                        href="/tag/monitoring.html"
                        class="article-sidebar-tag-link"
                        >monitoring</a
                      >
                    </div>
                  </td>
                  
                </tr>
              </table>
            </div>

            <div class="article-sidebar-block">
              <div class="article-sidebar-social">
                <em>I'm on Facebook/X at</em>
                <br /><a href="https://facebook.com/ntheanh201"
                  ><strong>@ntheanh201</strong></a
                >.
              </div>
            </div>
          </div>
        </div>
        

        
        <div class="article-center">
          <div class="article-content"><p></p>
<div class="notion-page" id="bb29a6d9-5e52-466c-9636-5f6d0e95fb75">
  <h2 id="heading-gioi-thieu" class="">Gi·ªõi thi·ªáu
  </h2>
  <p id="1e7a6f80-71d9-8061-b62a-daeff2f38124" class=" notion-text-block">Khi qu·∫£n l√Ω h·ªá th·ªëng CDN (Content Delivery Network) ho·∫∑c proxy server nh∆∞ Apache Traffic Server (ATS), vi·ªác ph√¢n t√≠ch logs l√† m·ªôt ph·∫ßn quan tr·ªçng ƒë·ªÉ hi·ªÉu r√µ v·ªÅ l∆∞u l∆∞·ª£ng truy c·∫≠p, hi·ªáu su·∫•t h·ªá th·ªëng v√† ph√°t hi·ªán c√°c v·∫•n ƒë·ªÅ ti·ªÅm ·∫©n.
  </p>
  <p id="1e7a6f80-71d9-80cf-a05a-d3d3c3b8f691" class=" notion-text-block">Trong b√†i vi·∫øt n√†y, ch√∫ng ta s·∫Ω t√¨m hi·ªÉu c√°ch k·∫øt h·ª£p ATS Squid logs v·ªõi PLG Stack (Promtail, Loki, Grafana) v√† t√≠ch h·ª£p d·ªØ li·ªáu GeoIP ƒë·ªÉ tr·ª±c quan h√≥a th√¥ng tin v·ªã tr√≠ ƒë·ªãa l√Ω c·ªßa ng∆∞·ªùi d√πng.
  </p>
  <h2 id="heading-apache-traffic-server-va-squid-logs" class="">Apache Traffic Server v√† Squid Logs
  </h2>
  <p id="1e7a6f80-71d9-8078-9b80-e1f2c036666f" class=" notion-text-block">Apache Traffic Server (ATS) l√† m·ªôt m√°y ch·ªß proxy m·∫°nh m·∫Ω v√† c√≥ kh·∫£ nƒÉng m·ªü r·ªông cao, th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng trong c√°c h·ªá th·ªëng CDN. ATS cung c·∫•p nhi·ªÅu ƒë·ªãnh d·∫°ng logging kh√°c nhau, v√† m·ªôt trong s·ªë ƒë√≥ l√† ƒë·ªãnh d·∫°ng Squid logs.
  </p>
  <p id="1e7a6f80-71d9-80b9-b844-e3909003ab71" class=" notion-text-block">Squid logs trong ATS c√≥ c·∫•u tr√∫c nh∆∞ sau:
  </p><pre tabindex="0" class="chroma"><code><span class="line"><span class="cl"><span class="nt">formats</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">squid</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;%&lt;cqtq&gt; %&lt;ttms&gt; %&lt;chi&gt; %&lt;cquuh&gt; &#34;%&lt;{User-agent}cqh&gt;&#34; %&lt;cr&gt; %&lt;pssc&gt; %&lt;psql&gt; %&lt;cqhm&gt; %&lt;cquc&gt; %&lt;psct&gt;&#39;</span><span class="w">
</span></span></span></code></pre>
  <p id="1e7a6f80-71d9-805d-a15b-f9a33445679b" class=" notion-text-block">Trong ƒë√≥:
  </p>
  <ul id="1e7a6f80-71d9-807a-8780-ff86ea6deb34" class="bulleted-list">
    <li><code>%&lt;cqtq&gt;</code>: Th·ªùi gian y√™u c·∫ßu (timestamp)
    </li>
    <li><code>%&lt;ttms&gt;</code>: Th·ªùi gian ph·∫£n h·ªìi (milliseconds)
    </li>
    <li><code>%&lt;chi&gt;</code>: ƒê·ªãa ch·ªâ IP c·ªßa client
    </li>
    <li><code>%&lt;cquuh&gt;</code>: Host ƒë√≠ch c·ªßa y√™u c·∫ßu
    </li>
    <li><code>%&lt;{User-agent}cqh&gt;</code>: User agent
    </li>
    <li><code>%&lt;cr&gt;</code>: K·∫øt qu·∫£ cache (VD: TCP_MISS, TCP_HIT)
    </li>
    <li><code>%&lt;pssc&gt;</code>: HTTP status code
    </li>
    <li><code>%&lt;psql&gt;</code>: K√≠ch th∆∞·ªõc ph·∫£n h·ªìi
    </li>
    <li><code>%&lt;cqhm&gt;</code>: HTTP method
    </li>
    <li><code>%&lt;cquc&gt;</code>: URL ƒë√≠ch
    </li>
    <li><code>%&lt;psct&gt;</code>: Content type
    </li>
  </ul>
  <p id="1e7a6f80-71d9-807a-81f7-c585534ed196" class=" notion-text-block">V√≠ d·ª• v·ªÅ m·ªôt d√≤ng log:
  </p><pre tabindex="0" class="chroma"><code><span class="line"><span class="cl">1709909405.806 900 16.15.15.205 p1-cdn.cdn.vn &#34;PostmanRuntime/7.36.3&#34; TCP_MISS 200 2711294 GET http://origin.com/tv/155/output/abc.ts video/MP2T</span></span></code></pre>
  <h2 id="heading-plg-stack-promtail-loki-va-grafana" class="">PLG Stack: Promtail, Loki v√† Grafana
  </h2>
  <p id="1e7a6f80-71d9-80c8-837a-e72fca370a67" class=" notion-text-block">PLG Stack l√† m·ªôt b·ªô c√¥ng c·ª• m·∫°nh m·∫Ω ƒë·ªÉ thu th·∫≠p, l∆∞u tr·ªØ v√† tr·ª±c quan h√≥a d·ªØ li·ªáu logs:
  </p>
  <ol id="1e7a6f80-71d9-80b0-88a7-c88c62ac4dfc" class="numbered-list" start="1">
    <li><strong>Promtail</strong>: Agent thu th·∫≠p logs
    </li>
    <li><strong>Loki</strong>: H·ªá th·ªëng l∆∞u tr·ªØ v√† index logs
    </li>
    <li><strong>Grafana</strong>: N·ªÅn t·∫£ng tr·ª±c quan h√≥a d·ªØ li·ªáu
    </li>
  </ol>
  <p id="1e7a6f80-71d9-80ce-9fe6-c9c7425bd7ba" class=" notion-text-block">Trong b√†i vi·∫øt n√†y, ch√∫ng ta s·∫Ω t·∫≠p trung v√†o vi·ªác c·∫•u h√¨nh Promtail ƒë·ªÉ x·ª≠ l√Ω Squid logs t·ª´ ATS v√† th√™m th√¥ng tin GeoIP.
  </p>
  <h2 id="heading-tich-hop-geoip-voi-promtail" class="">T√≠ch h·ª£p GeoIP v·ªõi Promtail
  </h2>
  <p id="1e7a6f80-71d9-8006-a6e4-d490fa7e8f34" class=" notion-text-block">GeoIP l√† d·ªãch v·ª• cho ph√©p x√°c ƒë·ªãnh v·ªã tr√≠ ƒë·ªãa l√Ω d·ª±a tr√™n ƒë·ªãa ch·ªâ IP. MaxMind cung c·∫•p c∆° s·ªü d·ªØ li·ªáu GeoIP2 ƒë∆∞·ª£c s·ª≠ d·ª•ng r·ªông r√£i cho m·ª•c ƒë√≠ch n√†y. Promtail c√≥ th·ªÉ t√≠ch h·ª£p v·ªõi c∆° s·ªü d·ªØ li·ªáu GeoIP ƒë·ªÉ l√†m phong ph√∫ th√™m d·ªØ li·ªáu logs v·ªõi th√¥ng tin v·ªã tr√≠ ƒë·ªãa l√Ω.
  </p>
  <h3 id="heading-cau-hinh-promtail" class="">C·∫•u h√¨nh Promtail
  </h3>
  <p id="1e7a6f80-71d9-8022-9a83-dca626d5f11a" class=" notion-text-block">D∆∞·ªõi ƒë√¢y l√† c·∫•u h√¨nh Promtail ƒë·ªÉ x·ª≠ l√Ω Squid logs t·ª´ ATS v√† th√™m th√¥ng tin GeoIP:
  </p><pre tabindex="0" class="chroma"><code><span class="line"><span class="cl">scrape_configs:
</span></span><span class="line"><span class="cl">{% if ats %}
</span></span><span class="line"><span class="cl">  - job_name: trafficserver_squid_logs
</span></span><span class="line"><span class="cl">    pipeline_stages:
</span></span><span class="line"><span class="cl">    - regex:
</span></span><span class="line"><span class="cl">        expression: &#39;^(?P&lt;timestamp&gt;\d+\.\d+) (?P&lt;response_time&gt;\d+) (?P&lt;ip&gt;\d+\.\d+\.\d+\.\d+) ((?P&lt;edge_fqdn&gt;\S+)+) &#34;(?P&lt;user_agent&gt;[^&#34;]+)&#34; (?P&lt;outcome&gt;\w+) (?P&lt;status&gt;\d+) (?P&lt;size&gt;\d+) (?P&lt;method&gt;[A-Z]+) (?P&lt;url&gt;[^\s]+) (?P&lt;mime&gt;[^$]+)$&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    - labels:
</span></span><span class="line"><span class="cl">        timestamp:
</span></span><span class="line"><span class="cl">        response_time:
</span></span><span class="line"><span class="cl">        ip:
</span></span><span class="line"><span class="cl">        edge_fqdn:
</span></span><span class="line"><span class="cl">        user_agent:
</span></span><span class="line"><span class="cl">        outcome:
</span></span><span class="line"><span class="cl">        status:
</span></span><span class="line"><span class="cl">        size:
</span></span><span class="line"><span class="cl">        method:
</span></span><span class="line"><span class="cl">        url:
</span></span><span class="line"><span class="cl">        mime:
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    - geoip:
</span></span><span class="line"><span class="cl">        source: ip
</span></span><span class="line"><span class="cl">        db: &#34;/opt/mmdb/GeoLite2-City.mmdb&#34;
</span></span><span class="line"><span class="cl">        db_type: city
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    - labelallow:
</span></span><span class="line"><span class="cl">        - geoip_city_name
</span></span><span class="line"><span class="cl">        - geoip_country_name
</span></span><span class="line"><span class="cl">        - edge_fqdn
</span></span><span class="line"><span class="cl">        - outcome
</span></span><span class="line"><span class="cl">        - status
</span></span><span class="line"><span class="cl">        - method
</span></span><span class="line"><span class="cl">        - job
</span></span><span class="line"><span class="cl">        - host
</span></span><span class="line"><span class="cl">    - labeldrop:
</span></span><span class="line"><span class="cl">        - geoip_location_latitude
</span></span><span class="line"><span class="cl">        - geoip_location_longitude
</span></span><span class="line"><span class="cl">        - response_time
</span></span><span class="line"><span class="cl">        - ip
</span></span><span class="line"><span class="cl">        - url
</span></span><span class="line"><span class="cl">        - mime
</span></span><span class="line"><span class="cl">        - size
</span></span><span class="line"><span class="cl">        - user_agent
</span></span><span class="line"><span class="cl">    - timestamp:
</span></span><span class="line"><span class="cl">        source: timestamp
</span></span><span class="line"><span class="cl">        format: &#34;Unix&#34;
</span></span><span class="line"><span class="cl">    static_configs:
</span></span><span class="line"><span class="cl">    - targets:
</span></span><span class="line"><span class="cl">        - localhost
</span></span><span class="line"><span class="cl">      labels:
</span></span><span class="line"><span class="cl">        job: &#34;ats&#34;
</span></span><span class="line"><span class="cl">        host: {{ ansible_hostname }}
</span></span><span class="line"><span class="cl">        __path__: &#34;/opt/trafficserver/var/log/trafficserver/squid.log&#34;
</span></span><span class="line"><span class="cl">{% endif %}</span></span></code></pre>
  <h3 id="heading-phan-tich-cau-hinh" class="">Ph√¢n t√≠ch c·∫•u h√¨nh
  </h3>
  <ol id="1e7a6f80-71d9-8081-b423-c8c5cfc8b23f" class="numbered-list" start="1">
    <li><strong>Stage regex</strong>: S·ª≠ d·ª•ng bi·ªÉu th·ª©c ch√≠nh quy ƒë·ªÉ ph√¢n t√≠ch c√∫ ph√°p d√≤ng log v√† tr√≠ch xu·∫•t c√°c tr∆∞·ªùng d·ªØ li·ªáu.
    </li>
    <li><strong>Stage labels</strong>: Chuy·ªÉn ƒë·ªïi c√°c tr∆∞·ªùng ƒë√£ tr√≠ch xu·∫•t th√†nh labels.
    </li>
    <li><strong>Stage geoip</strong>: S·ª≠ d·ª•ng IP c·ªßa client ƒë·ªÉ tra c·ª©u th√¥ng tin ƒë·ªãa l√Ω t·ª´ c∆° s·ªü d·ªØ li·ªáu MaxMind.
    </li>
    <li><strong>Stage labelallow/labeldrop</strong>: L·ªçc c√°c labels ƒë·ªÉ ch·ªâ gi·ªØ l·∫°i nh·ªØng th√¥ng tin c·∫ßn thi·∫øt.
    </li>
    <li><strong>Stage timestamp</strong>: Chuy·ªÉn ƒë·ªïi tr∆∞·ªùng timestamp th√†nh ƒë·ªãnh d·∫°ng Unix ƒë·ªÉ Loki c√≥ th·ªÉ x·ª≠ l√Ω.
    </li>
  </ol>
  <h2 id="heading-loi-ich-cua-viec-tich-hop-geoip-voi-squid-logs" class="">L·ª£i √≠ch c·ªßa vi·ªác t√≠ch h·ª£p GeoIP v·ªõi Squid Logs
  </h2>
  <p id="1e7a6f80-71d9-8000-a5b6-c9f4109c7403" class=" notion-text-block">Vi·ªác k·∫øt h·ª£p th√¥ng tin GeoIP v·ªõi Squid logs mang l·∫°i nhi·ªÅu l·ª£i √≠ch:
  </p>
  <ol id="1e7a6f80-71d9-801f-b80e-f0390a515efb" class="numbered-list" start="1">
    <li><strong>Ph√¢n t√≠ch ph√¢n ph·ªëi ƒë·ªãa l√Ω c·ªßa ng∆∞·ªùi d√πng</strong>: Hi·ªÉu r√µ ng∆∞·ªùi d√πng c·ªßa b·∫°n ƒë·∫øn t·ª´ ƒë√¢u.
    </li>
    <li><strong>Ph√°t hi·ªán c√°c m·∫´u truy c·∫≠p b·∫•t th∆∞·ªùng</strong>: X√°c ƒë·ªãnh c√°c ho·∫°t ƒë·ªông ƒë√°ng ng·ªù t·ª´ c√°c khu v·ª±c ƒë·ªãa l√Ω kh√¥ng mong ƒë·ª£i.
    </li>
    <li><strong>T·ªëi ∆∞u h√≥a hi·ªáu su·∫•t CDN</strong>: ƒêi·ªÅu ch·ªânh chi·∫øn l∆∞·ª£c ph√¢n ph·ªëi n·ªôi dung d·ª±a tr√™n v·ªã tr√≠ ƒë·ªãa l√Ω c·ªßa ng∆∞·ªùi d√πng.
    </li>
  </ol>
  <h2 id="heading-truc-quan-hoa-du-lieu-trong-grafana" class="">Tr·ª±c quan h√≥a d·ªØ li·ªáu trong Grafana
  </h2>
  <p id="1e7a6f80-71d9-8035-bd23-ce6ea6bc56dd" class=" notion-text-block">Sau khi ƒë√£ c·∫•u h√¨nh Promtail ƒë·ªÉ thu th·∫≠p v√† l√†m phong ph√∫ d·ªØ li·ªáu logs, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng Grafana ƒë·ªÉ t·∫°o c√°c b·∫£ng ƒëi·ªÅu khi·ªÉn tr·ª±c quan. D∆∞·ªõi ƒë√¢y l√† m·ªôt s·ªë √Ω t∆∞·ªüng cho c√°c bi·ªÉu ƒë·ªì v√† b·∫£ng ƒëi·ªÅu khi·ªÉn:
  </p>
  <ol id="1e7a6f80-71d9-801c-95c6-db2af2cf0d7a" class="numbered-list" start="1">
    <li><strong>B·∫£n ƒë·ªì nhi·ªát th·∫ø gi·ªõi</strong>: Hi·ªÉn th·ªã ph√¢n ph·ªëi l∆∞u l∆∞·ª£ng truy c·∫≠p theo qu·ªëc gia.
    </li>
    <li><strong>Top 10 qu·ªëc gia/th√†nh ph·ªë</strong>: Bi·ªÉu ƒë·ªì hi·ªÉn th·ªã top 10 qu·ªëc gia ho·∫∑c th√†nh ph·ªë c√≥ l∆∞u l∆∞·ª£ng truy c·∫≠p cao nh·∫•t.
    </li>
    <li><strong>T·ª∑ l·ªá cache hit/miss theo khu v·ª±c</strong>: So s√°nh hi·ªáu su·∫•t cache gi·ªØa c√°c khu v·ª±c ƒë·ªãa l√Ω kh√°c nhau.
    </li>
    <li><strong>L∆∞u l∆∞·ª£ng theo th·ªùi gian v√† khu v·ª±c</strong>: Bi·ªÉu ƒë·ªì d√≤ng ch·∫£y hi·ªÉn th·ªã l∆∞u l∆∞·ª£ng truy c·∫≠p theo th·ªùi gian, ph√¢n chia theo khu v·ª±c ƒë·ªãa l√Ω.
    </li>
    <li><strong>M√£ tr·∫°ng th√°i HTTP theo qu·ªëc gia</strong>: Ph√¢n t√≠ch m√£ tr·∫°ng th√°i HTTP (200, 404, 500, v.v.) theo qu·ªëc gia ƒë·ªÉ x√°c ƒë·ªãnh c√°c v·∫•n ƒë·ªÅ c·ª• th·ªÉ c·ªßa khu v·ª±c.
    </li>
  </ol>
  <h2 id="heading-ket-luan" class="">K·∫øt lu·∫≠n
  </h2>
  <p id="1e7a6f80-71d9-8040-96d1-eed42b804bde" class=" notion-text-block">Vi·ªác k·∫øt h·ª£p ATS Squid logs v·ªõi PLG Stack v√† t√≠ch h·ª£p d·ªØ li·ªáu GeoIP mang l·∫°i m·ªôt gi·∫£i ph√°p m·∫°nh m·∫Ω ƒë·ªÉ gi√°m s√°t v√† ph√¢n t√≠ch l∆∞u l∆∞·ª£ng truy c·∫≠p theo th·ªùi gian th·ª±c. Th√¥ng qua vi·ªác tr·ª±c quan h√≥a th√¥ng tin v·ªã tr√≠ ƒë·ªãa l√Ω c·ªßa ng∆∞·ªùi d√πng, b·∫°n c√≥ th·ªÉ hi·ªÉu r√µ h∆°n v·ªÅ m·∫´u s·ª≠ d·ª•ng, t·ªëi ∆∞u h√≥a hi·ªáu su·∫•t CDN v√† ph√°t hi·ªán c√°c v·∫•n ƒë·ªÅ ti·ªÅm ·∫©n.
  </p>
  <p id="1e7a6f80-71d9-80c6-8abd-d31d76faf361" class=" notion-text-block">Gi·∫£i ph√°p n√†y kh√¥ng ch·ªâ h·ªØu √≠ch cho c√°c h·ªá th·ªëng CDN m√† c√≤n √°p d·ª•ng ƒë∆∞·ª£c cho b·∫•t k·ª≥ h·ªá th·ªëng n√†o s·ª≠ d·ª•ng Apache Traffic Server ho·∫∑c c√°c m√°y ch·ªß proxy kh√°c c√≥ kh·∫£ nƒÉng t·∫°o Squid logs.
  </p>
  <h2 id="heading-tai-lieu-tham-khao" class="">T√†i li·ªáu tham kh·∫£o
  </h2>
  <ol id="1e7a6f80-71d9-8015-ae19-d6a293088359" class="numbered-list" start="1">
    <li><a href="https://docs.trafficserver.apache.org/">Apache Traffic Server Documentation</a>
    </li>
    <li><a href="https://grafana.com/docs/loki/latest/">Grafana Loki Documentation</a>
    </li>
    <li><a href="https://dev.maxmind.com/geoip/geoip2/geolite2/">MaxMind GeoIP Databases</a>
    </li>
    <li><a href="https://grafana.com/docs/loki/latest/clients/promtail/pipelines/">Promtail Pipeline Documentation</a>
    </li>
  </ol>
</div></div>
        </div>

        
        
        <div class="toc-container">
          <div class="toc-sticky">
            <div class="article-sidebar-type">Table of contents</div>
            <div class="table-of-contents">
<h2>Table of Contents</h2>
<ul>
<li>
<a href="#heading-gioi-thieu">Gi·ªõi thi·ªáu</a>
</li>
<li>
<a href="#heading-apache-traffic-server-va-squid-logs">Apache Traffic Server v√† Squid Logs</a>
</li>
<li>
<a href="#heading-plg-stack-promtail-loki-va-grafana">PLG Stack: Promtail, Loki v√† Grafana</a>
</li>
<li>
<a href="#heading-tich-hop-geoip-voi-promtail">T√≠ch h·ª£p GeoIP v·ªõi Promtail</a>
<ul>
<li>
<a href="#heading-cau-hinh-promtail">C·∫•u h√¨nh Promtail</a>
</li>
<li>
<a href="#heading-phan-tich-cau-hinh">Ph√¢n t√≠ch c·∫•u h√¨nh</a>
</li>
</ul>
</li>
<li>
<a href="#heading-loi-ich-cua-viec-tich-hop-geoip-voi-squid-logs">L·ª£i √≠ch c·ªßa vi·ªác t√≠ch h·ª£p GeoIP v·ªõi Squid Logs</a>
</li>
<li>
<a href="#heading-truc-quan-hoa-du-lieu-trong-grafana">Tr·ª±c quan h√≥a d·ªØ li·ªáu trong Grafana</a>
</li>
<li>
<a href="#heading-ket-luan">K·∫øt lu·∫≠n</a>
</li>
<li>
<a href="#heading-tai-lieu-tham-khao">T√†i li·ªáu tham kh·∫£o</a>
</li>
</ul>
</div>

          </div>
        </div>
        
      </div>

      <div class="article-footer">
        
        <em>
          <a href="https://facebook.com/ntheanh201"> @ntheanh201</a>
        </em>
        
      </div>
    </div>

    

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        
        const tocLinks = document.querySelectorAll(".table-of-contents a");

        
        tocLinks.forEach((link) => {
          link.addEventListener("click", function (e) {
            e.preventDefault();

            
            const targetId = this.getAttribute("href").substring(1);
            const targetElement = document.getElementById(targetId);

            if (targetElement) {
              
              targetElement.scrollIntoView({
                behavior: "smooth",
                block: "start",
              });

              
              history.pushState(null, null, "#" + targetId);
            }
          });
        });

        
        if (window.location.hash) {
          const targetId = window.location.hash.substring(1);
          const targetElement = document.getElementById(targetId);

          if (targetElement) {
            setTimeout(() => {
              targetElement.scrollIntoView({
                behavior: "smooth",
                block: "start",
              });
            }, 300);
          }
        }
      });
    </script>
  </body>
</html>
